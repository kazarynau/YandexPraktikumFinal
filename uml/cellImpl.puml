
@startuml

abstract class GraphInterface {
    +{abstract} GetReferencedCells(): vector<Position>
    +{abstract} GetDependentCells(): vector<Position>
    +{abstract} AddDependentCell(in pos: Position)
    +{abstract} DeleteDependentCell(in pos: Position)
    +{abstract} HasCircularDependency(inout visitedCells: unordered_set<CellInterface*>&, \nin currentCell: Position, in referencedCells: vector<Position>)
}

abstract class Impl {
    +{abstract} GetValue(in getCellValueCallback: function): Value
    +{abstract} GetText(): string
    +{abstract} InvalidateCache()
}

class Impl extends GraphInterface

class EmptyImpl {
    -dependentCells_: unordered_set<Position>
}

class TextImpl {
    +TextImpl(in text: string)
    +Set(in text: string)
    -value_: string
    -dependentCells_: unordered_set<Position>
}

class FormulaImpl {
    +FormulaImpl(in sheet: SheetInterface, in text: string)
    +Set(in text: string)

    -sheet_: SheetInterface&
    -formula_: unique_ptr<FormulaInterface>
    -dependentCells_: unordered_set<Position>
    -cache_: optional<CellInterface::Value>
}

class EmptyImpl implements Impl
class TextImpl implements Impl
class FormulaImpl implements Impl

@enduml
